---
title: 什么是依赖注入
date: 2025-09-01 16:57:04
tags:
---

# 什么是依赖注入

详细解释一下 **依赖注入（Dependency Injection, 简称 DI）**。



## 1️⃣ 背景：为什么需要依赖注入


在编程中，类往往需要依赖其他类才能完成工作。比如：

<!--more-->
```java
public class UserService {
    private UserRepository userRepository = new UserRepository();

    public void addUser(String name) {
        userRepository.save(name);
    }
}

```

这里 `UserService` 直接在内部 `new` 了一个 `UserRepository` 对象。
这样会产生两个问题：


1. **耦合度高**：如果以后要换成 `MysqlUserRepository` 或 `RedisUserRepository`，就得改 `UserService` 的代码。
2. **难以测试**：如果我只想单元测试 `UserService`，就没办法传一个“假的 UserRepository（Mock）”进去。


## 2️⃣ 什么是依赖注入


**依赖注入** 就是：


- 把一个类所依赖的对象（即“依赖”），交给 **外部容器（如 Spring）来创建和管理**，
- 然后“注入”到这个类里，而不是让类自己去创建。

👉 换句话说：
类只声明“我需要什么”（依赖），而不关心“这个依赖怎么来”。



## 3️⃣ 实现方式


在 Spring 里，DI 主要有三种实现方式：


1. **构造器注入**

```java
@Service
public class UserService {
    private final UserRepository userRepository;

    @Autowired
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}

```
2. **Setter 注入**

```java
@Service
public class UserService {
    private UserRepository userRepository;

    @Autowired
    public void setUserRepository(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}

```
3. **字段注入（不推荐）**

```java
@Service
public class UserService {
    @Autowired
    private UserRepository userRepository;
}

```

Spring 会在容器启动时，扫描到这些类，自动把 `UserRepository` 的实例注入到 `UserService` 里。



## 4️⃣ 好处


- **降低耦合**：类不依赖具体实现，而依赖抽象接口。
- **提高可测试性**：可以轻松替换依赖（比如用 Mock）。
- **更灵活**：只需要在配置里声明依赖关系，代码不用改。
- **符合“控制反转（IoC）”原则**：对象的控制权交给 Spring 容器，而不是自己控制。


## 5️⃣ 小结


- **IoC（控制反转）** = 思想：对象创建与管理交给容器。
- **DI（依赖注入）** = 实现 IoC 的主要方式：容器把对象注入到需要它的类中。
